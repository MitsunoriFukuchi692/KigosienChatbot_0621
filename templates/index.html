<!-- index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä»‹è­·æ”¯æ´ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="chat-container">
    <!-- ä»‹è­·å£«ã¨è¢«ä»‹è­·è€…å…¥åŠ›æ¬„ -->
    <div id="inputs">
      <div class="input-block" id="caregiver-block">
        <button class="mic-btn" id="caregiver-mic">ğŸ¤</button>
        <textarea id="caregiver-input" placeholder="ä»‹è­·å£«ã®ç™ºè¨€ã‚’å…¥åŠ›"></textarea>
      </div>
      <div class="input-block" id="caree-block">
        <button class="mic-btn" id="caree-mic">ğŸ¤</button>
        <textarea id="caree-input" placeholder="è¢«ä»‹è­·è€…ã®ç™ºè¨€ã‚’å…¥åŠ›"></textarea>
      </div>
    </div>

    <!-- ç”¨èªèª¬æ˜ã‚¨ãƒªã‚¢ -->
    <div id="glossary">
      <input type="text" id="term" placeholder="ç”¨èªã‚’å…¥åŠ›" />
      <button id="explain-btn">èª¬æ˜</button>
      <p id="explanation"></p>
    </div>

    <!-- ãƒãƒ£ãƒƒãƒˆè¡¨ç¤º -->
    <div id="chat-log"></div>
  </div>

  <script src="chatbot.js"></script>
</body>
</html>

/* styles.css */
#chat-container { max-width: 600px; margin: auto; padding: 1rem; }
.input-block { display: flex; align-items: center; margin-bottom: 0.5rem; }
.mic-btn { width: 2.5rem; height: 2.5rem; font-size: 1.5rem; margin-right: 0.5rem; }
textarea { flex: 1; height: 3rem; }
#glossary { margin: 1rem 0; }
#explanation { margin-top: 0.5rem; }

// chatbot.js
const caregiverMic = document.getElementById('caregiver-mic');
const careeMic = document.getElementById('caree-mic');
const caregiverInput = document.getElementById('caregiver-input');
const careeInput = document.getElementById('caree-input');
const explainBtn = document.getElementById('explain-btn');
const termInput = document.getElementById('term');
const explanationP = document.getElementById('explanation');

// éŸ³å£°èªè­˜å…±é€šè¨­å®š
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
  alert('ãƒ–ãƒ©ã‚¦ã‚¶ãŒéŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚');
}
const recog = new SpeechRecognition();
recog.lang = 'ja-JP';
recog.interimResults = false;

let activeTarget = null;
recog.onresult = (e) => {
  const text = e.results[0][0].transcript;
  if (activeTarget) activeTarget.value = text;
};
recog.onerror = (e) => { console.error(e); };

caregiverMic.addEventListener('click', () => {
  activeTarget = caregiverInput;
  recog.start();
});
careeMic.addEventListener('click', () => {
  activeTarget = careeInput;
  recog.start();
});

// ç”¨èªèª¬æ˜æ©Ÿèƒ½
explainBtn.addEventListener('click', async () => {
  const term = termInput.value.trim();
  if (!term) return;
  // APIå‘¼ã³å‡ºã—ä¾‹ï¼ˆå®Ÿéš›ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«åˆã‚ã›ã¦ä¿®æ­£ï¼‰
  const response = await fetch('/api/explain', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ term, maxLength: 30 })
  });
  const data = await response.json();
  explanationP.textContent = data.explanation;
  // èª­ã¿ä¸Šã’
  const utter = new SpeechSynthesisUtterance(data.explanation);
  utter.lang = 'ja-JP';
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèª¿æ•´ã—ãŸã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤ã‚’å–å¾—ã™ã‚‹ä¾‹
  utter.rate = window.ttsRate || 1;
  utter.volume = window.ttsVolume || 1;
  speechSynthesis.speak(utter);
});
